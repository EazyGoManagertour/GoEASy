<!DOCTYPE html>
<html lang="zxx">

@Html.Partial("~/Views/client/share/head.cshtml")
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<link href="/assets/css/home.css" rel="stylesheet" />

<body>
    <div class="page-wrapper">

        <!-- Preloader -->
        <div class="preloader"><div class="custom-loader"></div></div>

        <!-- main header -->
        <header class="main-header header-one white-menu menu-absolute">
            @Html.Partial("~/Views/client/share/header.cshtml")
        </header>


        <!--Form Back Drop-->
        <div class="form-back-drop"></div>

        <!-- Hidden Sidebar -->
        <section class="hidden-bar">
            <div class="inner-box text-center">
                <div class="cross-icon"><span class="fa fa-times"></span></div>
                <div class="title">
                    <h4>Đặt lịch hẹn</h4>
                </div>

                <!--Appointment Form-->
                <div class="appointment-form">
                    <form method="post" action="https://webtendtheme.net/html/2024/ravelo/contact.html">
                        <div class="form-group">
                            <input type="text" name="text" value="" placeholder="Họ và tên" required>
                        </div>
                        <div class="form-group">
                            <input type="email" name="email" value="" placeholder="Địa chỉ email" required>
                        </div>
                        <div class="form-group">
                            <textarea placeholder="Nội dung" rows="5"></textarea>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="theme-btn style-two">
                                <span data-hover="Gửi ngay">Gửi ngay</span>
                                <i class="fal fa-arrow-right"></i>
                            </button>
                        </div>
                    </form>
                </div>

                <!--Social Icons-->
                <div class="social-style-one">
                    <a href="contact.html"><i class="fab fa-twitter"></i></a>
                    <a href="contact.html"><i class="fab fa-facebook-f"></i></a>
                    <a href="contact.html"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-pinterest-p"></i></a>
                </div>
            </div>
        </section>
        <!--End Hidden Sidebar -->
        <!-- Hero Area Start -->
        <section class="hero-area bgc-black pt-200 rpt-120 rel z-2">
            <div class="container-fluid">
                <h1 class="hero-title" data-aos="flip-up" data-aos-delay="50" data-aos-duration="1500" data-aos-offset="50">Du lịch & Khám phá</h1>
                <div class="main-hero-image bgs-cover" style="background-image: url(assets/images/hero/hero.jpg);"></div>
            </div>
        </section>
        <!-- Hero Area End -->
        <!-- Destinations Area start -->
        <section class="destinations-area bgc-black pt-100 pb-70 rel z-1">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-lg-12">
                        <div class="section-title text-white text-center counter-text-wrap mb-70" data-aos="fade-up" data-aos-duration="1500" data-aos-offset="50">
                            <h2>Tour du lịch độc đáo tại Việt Nam</h2>
                            <p>Nơi hội tụ những trải nghiệm nổi bật nhất bạn sẽ nhớ mãi</p>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="slider-container">
                        <!-- Navigation buttons -->
                        <div class="slider-nav prev" onclick="prevSlide()">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                        <div class="slider-nav next" onclick="nextSlide()">
                            <i class="fas fa-chevron-right"></i>
                        </div>

                        <!-- Slider wrapper -->
                        <div class="slider-wrapper" id="sliderWrapper">
                            @if (ViewBag.Tours != null)
                            {
                                foreach (var tour in (IEnumerable<GoEASy.Models.Tour>)ViewBag.Tours)
                                {
                                    var coverImg = tour.TourImages?.FirstOrDefault(img => img.IsCover == true)?.ImageURL
                                    ?? tour.TourImages?.FirstOrDefault()?.ImageURL
                                    ?? "/assets/images/destinations/destination1.jpg";

                                    <div class="col-xxl-3 col-xl-4 col-md-6">
                                        <div class="destination-item" data-aos="fade-up" data-aos-duration="1500" data-aos-offset="50">
                                            <div class="image" style="height: 294.18px;">
                                                <div class="ratting"><i class="fas fa-star"></i> 4.8</div>
                                                @{
                                                    var isFavorite = ViewBag.FavoriteTourIds != null && ((List<int>)ViewBag.FavoriteTourIds).Contains(tour.TourID);
                                                }
                                                <a href="javascript:void(0);" class="heart@(isFavorite ? " active" : "")" data-tour-id="@tour.TourID">
                                                    <i class="fas fa-heart"></i>
                                                </a>
                                                <img src="@coverImg" alt="@tour.TourName">
                                            </div>

                                            <div class="content">
                                                <span class="location"><i class="fal fa-map-marker-alt"></i>@tour.Destination.DestinationName</span>
                                                <h5><a href="/tour-details/@tour.TourID">@tour.TourName</a></h5>
                                                <span class="time">@tour.Description</span>
                                            </div>
                                            <div class="destination-footer">
                                                <span class="price">@tour.AdultPrice.ToString("N0") VNĐ/người</span>
                                                <a href="/tour-details/@tour.TourID" class="read-more">See Now <i class="fal fa-angle-right"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }

                        </div>

                        <!-- Dots indicator - sẽ tự động tạo theo số item -->
                        <div class="slider-dots" id="sliderDots"></div>
                    </div>


                </div>
            </div>
        </section>
        <!-- Destinations Area end -->
        <!-- About Us Area start -->
        <section class="about-us-area py-100 rpb-90 rel z-1">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-xl-5 col-lg-6">
                        <div class="about-us-content rmb-55" data-aos="fade-left" data-aos-duration="1500" data-aos-offset="50">
                            <div class="section-title mb-25">
                                <h2>Lý do nên chọn chúng tôi cho chuyến đi của bạn</h2>
                            </div>
                            <p>Chúng tôi luôn nỗ lực để biến giấc mơ du lịch của bạn thành hiện thực, từ những điểm đến nổi tiếng đến các trải nghiệm độc đáo.</p>
                            <div class="divider counter-text-wrap mt-45 mb-55"><span>Chúng tôi có <span><span class="count-text plus" data-speed="3000" data-stop="25">0</span> Năm</span> kinh nghiệm</span></div>
                            <div class="row">
                                <div class="col-6">
                                    <div class="counter-item counter-text-wrap">
                                        <span class="count-text k-plus" data-speed="3000" data-stop="3">0</span>
                                        <span class="counter-title">Điểm đến nổi bật</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="counter-item counter-text-wrap">
                                        <span class="count-text m-plus" data-speed="3000" data-stop="9">0</span>
                                        <span class="counter-title">Khách hàng hài lòng</span>
                                    </div>
                                </div>
                            </div>
                            <a href="/destination" class="theme-btn mt-10 style-two">
                                <span data-hover="Khám phá điểm đến">Khám phá điểm đến</span>
                                <i class="fal fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col-xl-7 col-lg-6" data-aos="fade-right" data-aos-duration="1500" data-aos-offset="50">
                        <div class="about-us-image">
                            <div class="shape"><img src="assets/images/about/shape1.png" alt="Shape"></div>
                            <div class="shape"><img src="assets/images/about/shape2.png" alt="Shape"></div>
                            <div class="shape"><img src="assets/images/about/shape3.png" alt="Shape"></div>
                            <div class="shape"><img src="assets/images/about/shape4.png" alt="Shape"></div>
                            <div class="shape"><img src="assets/images/about/shape5.png" alt="Shape"></div>
                            <div class="shape"><img src="assets/images/about/shape6.png" alt="Shape"></div>
                            <div class="shape"><img src="assets/images/about/shape7.png" alt="Shape"></div>
                            <img src="assets/images/about/about.png" alt="About">
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- About Us Area end -->
        <!-- Popular Destinations Area start -->
        <section class="popular-destinations-area rel z-1">
            <div class="container-fluid">
                <div class="popular-destinations-wrap br-20 bgc-lighter pt-100 pb-70">
                    <div class="row justify-content-center">
                        <div class="col-lg-12">
                            <div class="section-title text-center counter-text-wrap mb-70" data-aos="fade-up" data-aos-duration="1500" data-aos-offset="50">
                                <h2>Khám phá điểm đến phổ biến</h2>
                                <p>Nơi hội tụ những trải nghiệm nổi bật nhất</p>
                            </div>
                        </div>
                    </div>

                    <div class="container">
                        <div class="row justify-content-center">
                            @{

                                var colClasses = new[] {
                                                        "col-xl-3 col-md-6", "col-xl-3 col-md-6","col-md-6",  "col-md-6" ,"col-xl-3 col-md-6"
                                                        , "col-xl-3 col-md-6"
                                                        };
                                int i = 0;
                            }
                            @foreach (var dest in Model)
                            {
                                GoEASy.Models.DestinationImage coverImage = null;
                                foreach (var img in dest.DestinationImages)
                                {
                                    if (img.IsCover == true)
                                    {
                                        coverImage = img;
                                        break;
                                    }
                                }
                                var imageUrl = coverImage != null ? coverImage.ImageURL : "/assets/images/destinations/destination1.jpg";
                                var colClass = colClasses.Length > i ? colClasses[i] : "col-xl-3 col-md-6";
                                <div class="@colClass">
                                    <div class="destination-item style-two" data-aos="flip-up" data-aos-delay="@(100 + i * 100)" data-aos-duration="1500" data-aos-offset="50">
                                        <div class="image">
                                            <a href="#" class="heart"><i class="fas fa-heart"></i></a>
                                            <img src="@imageUrl" alt="@dest.DestinationName">
                                        </div>
                                        <div class="content">
                                            <h6><a href="/destination/details/@dest.DestinationID">@dest.DestinationName</a></h6>
                                            @{
                                                var tourCount = dest.Tours?.Count ?? 0;
                                            }
                                            <span class="time">@tourCount tour &amp; activity</span>
                                            <a href="/destination/details/@dest.DestinationID" class="more"><i class="fas fa-chevron-right"></i></a>
                                        </div>
                                    </div>
                                </div>
                                i++;
                            }
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Popular Destinations Area end -->
        @* <h3>Gợi ý cho bạn</h3>
        <ul id="suggest-list"></ul>

        <h4>Gợi ý AI (VIP PRO)</h4>
        <input type="text" id="ai-query" placeholder="Ví dụ: tour biển, 5 triệu, lặn san hô..." />
        <button onclick="recommendAI()">Gợi ý AI</button>
        <ul id="ai-result"></ul>
        
        <div id="auto-recommend"></div> *@

        <!-- Hotel Area start -->
        <section id="ai-recommend-section" class="hotel-area bgc-black py-100 rel z-1">
            <div class="container-fluid">
                <div class="row justify-content-center">
                    <div class="col-lg-12">
                        <div class="section-title text-white text-center counter-text-wrap mb-70" data-aos="fade-up" data-aos-duration="1500" data-aos-offset="50">
                            <h2>Chúng tôi chọn lọc những điểm du lịch đáng giá nhất dành cho bạn.</h2>
                            <p>Có thể bạn sẽ quan tâm đến những hành trình tương tự…</p>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center" id="auto-recommend">
                    <!-- Hiển thị danh sách gợi ý ở đây -->
                    <!-- Ở đầu file, backend render ra userId nếu đã đăng nhập -->
                    <input type="hidden" id="currentUserId" value="@Context.Session.GetInt32("UserID")">
                </div>
            </div>
        </section>
        <!-- Hotel Area end -->
        <!-- Blog Area start -->
        @{
            var blogs = ViewBag.Blogs as List<GoEASy.Models.Blog>;

        }

        <section class="cta-area pt-100 rel z-1">
            <div class="container-fluid">
                <div class="row">
                    @if (blogs != null && blogs.Count > 0)
                    {
                        foreach (var blog in blogs)
                        {

                            var cover = blog.BlogImages?.FirstOrDefault(img => img.IsMain == true)?.ImageURL ?? "/image/default.jpg"; ;

                            <div class="col-xl-4 col-md-6" data-aos="zoom-in-down" data-aos-duration="1500" data-aos-offset="50">
                                <div class="cta-item" style="background-image: url('@cover');">
                                    <span class="category">@blog.Category?.CategoryName</span>
                                    <h2>@blog.Title</h2>
                                    <a href="/blog-detail/@blog.BlogID" class="theme-btn style-two bgc-secondary">
                                        <span data-hover="Khám phá tour">See Blog</span>
                                        <i class="fal fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div style="color:red;padding:15px">Không có bài viết nào!</div>
                    }
                </div>
            </div>
        </section>
        <!-- Blog Area end -->
        <!-- footer area start -->
        @Html.Partial("~/Views/client/share/footer.cshtml")
        <!-- footer area end -->
    </div>
    <!--End pagewrapper-->
    @Html.Partial("~/Views/client/share/script.cshtml")
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing Swiper...');
            var swiperElement = document.querySelector('.destinations-swiper');
            console.log('Swiper element:', swiperElement);

            if (swiperElement) {
                var swiper = new Swiper('.destinations-swiper', {
                slidesPerView: 4,
                spaceBetween: 30,
                loop: true,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                breakpoints: {
                    1200: { slidesPerView: 4 },
                    992: { slidesPerView: 3 },
                    768: { slidesPerView: 2 },
                    0: { slidesPerView: 1 }
                }
            });
            } else {
                console.log('Swiper element not found!');
            }
        });
    </script>


    <script>
        function loadSuggestions() {
            const userId = document.getElementById('currentUserId')?.value;
            if (!userId) {
                document.getElementById('suggested-tours').innerHTML = '<li>Bạn cần đăng nhập để nhận gợi ý.</li>';
                return;
            }

            fetch('/api/recommend/history?userId=<%= session.getAttribute("UserID") %>')
                .then(res => res.json())
                .then(data => {
                    let html = "";
                    data.forEach(t => {
                        html += `<li><b>${t.title}</b> (${t.price}đ) - ${t.shortDescription}</li>`;
                    });
                    document.getElementById('suggested-tours').innerHTML = html;
                });
        }

        window.onload = loadSuggestions;
    </script>


    <script>
        function recommendAI() {
            const query = document.getElementById('ai-query').value;
            fetch('/api/recommend/semantic', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: query, topK: 5 })
            }).then(res => res.json())
              .then(data => {
                let html = '';
                data.forEach(t => {
                    html += `<li><b>${t.title}</b> (${t.price}đ) - ${t.desc}</li>`;
                });
                document.getElementById('ai-result').innerHTML = html;
              });
        }
    </script>

    <script>
                function getCurrentTourIdFromUrl() {
            const path = window.location.pathname; // /tour-details/5
            const parts = path.split('/');
            const id = parseInt(parts[parts.length - 1]);
            return isNaN(id) ? 0 : id;
        }
    </script>

    <script>
                function autoRecommendForUser() {
                    const currentTourId = getCurrentTourIdFromUrl();
            const userId = parseInt(document.getElementById('currentUserId')?.value);
            if (!userId) {
                document.getElementById('auto-recommend').innerHTML = '<div style="color:gray">Bạn cần <a href="/login">đăng nhập</a> để nhận gợi ý theo lịch sử.</div>';
                return;
            }

            fetch('http://localhost:5001/recommend', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    query: "",
                    user_id: userId,
                    current_tour_id: currentTourId, // ✅ tour vừa bấm
                    top_k: 4
                })
            })
            .then(response => response.json())
            .then(data => {
            let html = '<h3 class="mb-4 text-center">Gợi ý cho bạn:</h3>';

            data.forEach((tour, i) => {
                const title = tour.title || "Không có tiêu đề";
                const desc = tour.desc || "Không có mô tả.";
                const price = tour.price ? Number(tour.price).toLocaleString() : "0";
                const destination = tour.destination || "Không rõ địa điểm";
                const image = tour.image?.startsWith("/") ? tour.image : "/assets/images/no-image.jpg";

                html += `
                <div class="col-xxl-6 col-xl-8 col-lg-10 mb-4">
                    <div class="destination-item style-three" data-aos="fade-up" data-aos-duration="1500" data-aos-offset="50">
                        <div class="image">
                            <div class="ratting"><i class="fas fa-star"></i> 4.8</div>
                            <a href="#" class="heart"><i class="fas fa-heart"></i></a>
                            <img src="${image}" alt="Tour Image" style="width:100%">
                        </div>
                        <div class="content">
                            <span class="location"><i class="fal fa-map-marker-alt"></i> ${destination}</span>
                            <h5><a href="/tour-details/${tour.id}">${title}</a></h5>
                            <ul class="list-style-one">
                                <span class="time">${desc}</span>
                            </ul>
                            <div class="destination-footer">
                                <span class="price"><span>${price} đ</span> /người</span>
                                <a href="" class="read-more">Đặt ngay <i class="fal fa-angle-right"></i></a>
                            </div>
                        </div>
                    </div>
                </div>`;
            });

            document.getElementById('auto-recommend').innerHTML = html;

            // ✅ Quan trọng: khởi động lại AOS
            if (AOS) AOS.init();
            });
        }
        // Gọi hàm này khi vào trang (hoặc sau khi click xem tour xong)
        window.onload = autoRecommendForUser;
    </script>

    <script>
        let currentIndex = 0;
        const items = document.querySelectorAll('.slider-wrapper .col-xxl-3');
        const totalItems = items.length;
        const itemsPerView = getItemsPerView();

        function getItemsPerView() {
            if (window.innerWidth <= 576) return 1;
            if (window.innerWidth <= 768) return 2;
            if (window.innerWidth <= 1200) return 3;
            return 4;
        }

        function updateSlider() {
            const sliderWrapper = document.getElementById('sliderWrapper');
            const itemWidth = 100 / getItemsPerView();
            const translateX = -(currentIndex * itemWidth);

            sliderWrapper.style.transform = `translateX(${translateX}%)`;

            updateNavigationButtons();
            updateDots();
        }

        function updateNavigationButtons() {
            const prevBtn = document.querySelector('.slider-nav.prev');
            const nextBtn = document.querySelector('.slider-nav.next');
            const maxIndex = totalItems - getItemsPerView();

            prevBtn.classList.toggle('disabled', currentIndex === 0);
            nextBtn.classList.toggle('disabled', currentIndex >= maxIndex);
        }

        function updateDots() {
            const dotsContainer = document.getElementById('sliderDots');
            const itemsPerView = getItemsPerView();
            const totalDots = Math.ceil((totalItems - itemsPerView + 1));

            // Tạo dots
            dotsContainer.innerHTML = '';
            for (let i = 0; i < totalDots; i++) {
                const dot = document.createElement('span');
                dot.className = 'dot';
                if (i === currentIndex) dot.classList.add('active');
                dot.onclick = () => goToSlide(i);
                dotsContainer.appendChild(dot);
            }
        }

        function nextSlide() {
            const maxIndex = totalItems - getItemsPerView();
            if (currentIndex < maxIndex) {
                currentIndex++;
                updateSlider();
            }
        }

        function prevSlide() {
            if (currentIndex > 0) {
                currentIndex--;
                updateSlider();
            }
        }

        function goToSlide(index) {
            const maxIndex = totalItems - getItemsPerView();
            currentIndex = Math.min(index, maxIndex);
            updateSlider();
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            const newItemsPerView = getItemsPerView();
            const maxIndex = totalItems - newItemsPerView;
            if (currentIndex > maxIndex) {
                currentIndex = Math.max(0, maxIndex);
            }
            updateSlider();
        });

        // Initialize
        updateSlider();
    </script>
    <script>
        $(document).on('click', '.heart', function(e) {
                e.preventDefault();
                var $btn = $(this);
                var tourId = $btn.data('tour-id');
                var isActive = $btn.hasClass('active');
                var url = isActive ? '/favorite/remove' : '/favorite/add';

                $.ajax({
                    url: url,
                    type: 'POST',
                    data: { tourId: tourId },
                    success: function(response) {
                        if (response.success) {
                            $btn.toggleClass('active');
                        } else {
                            alert(response.message);
                        }
                    },
                    error: function() {
                        alert('Có lỗi xảy ra, vui lòng thử lại!');
                    }
                });
            });
    </script>

    <script>
        window.addEventListener("DOMContentLoaded", function () {
            const userId = parseInt(document.getElementById("currentUserId")?.value || "0");
            const section = document.getElementById("ai-recommend-section");

            if (!userId && section) {
                section.style.display = "none";
            }
        });
    </script>
</body>

<!-- Mirrored from webtendtheme.net/html/2024/ravelo/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 07 Oct 2024 09:27:04 GMT -->
</html>
